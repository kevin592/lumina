<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lumina OKR ç®¡ç†ç³»ç»Ÿ - äº¤äº’åŸå‹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --primary-light: #e0e7ff;
      --success: #10b981;
      --success-light: #dcfce7;
      --warning: #f59e0b;
      --warning-light: #fef3c7;
      --danger: #ef4444;
      --danger-light: #fee2e2;
      --bg-main: #f8fafc;
      --bg-card: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --border: #e2e8f0;
      --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-main);
      color: var(--text-primary);
      line-height: 1.5;
      padding-bottom: 40px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* ========== Header ========== */
    .header {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 16px 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow);
    }

    .btn-secondary {
      background: var(--bg-main);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
    }

    .btn-ghost:hover {
      background: var(--bg-main);
      color: var(--text-primary);
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 13px;
    }

    /* ========== Page Title ========== */
    .page-header {
      margin: 32px 0 24px;
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .page-subtitle {
      color: var(--text-secondary);
      font-size: 15px;
    }

    /* ========== Tabs ========== */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 1px solid var(--border);
    }

    .tab {
      padding: 12px 20px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .tab:hover {
      color: var(--text-primary);
    }

    .tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    /* ========== OKR Grid ========== */
    .okr-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .okr-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: all 0.2s;
      position: relative;
    }

    .okr-card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    .okr-card-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .okr-title-wrapper {
      flex: 1;
    }

    .okr-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.15s;
    }

    .okr-title:hover {
      background: var(--bg-main);
    }

    .okr-title.editing {
      background: white;
      border: 2px solid var(--primary);
      outline: none;
      padding: 4px 8px;
    }

    .okr-period {
      font-size: 12px;
      color: var(--text-secondary);
      background: var(--bg-main);
      padding: 4px 8px;
      border-radius: 4px;
      display: inline-block;
    }

    .okr-menu {
      position: relative;
    }

    .okr-menu-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }

    .okr-menu-btn:hover {
      background: var(--bg-main);
      color: var(--text-primary);
    }

    .okr-menu-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
      min-width: 160px;
      z-index: 10;
      display: none;
      overflow: hidden;
    }

    .okr-menu-dropdown.show {
      display: block;
      animation: dropdownFadeIn 0.15s ease;
    }

    @keyframes dropdownFadeIn {
      from {
        opacity: 0;
        transform: translateY(-4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .okr-menu-item {
      padding: 10px 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-primary);
      transition: all 0.15s;
    }

    .okr-menu-item:hover {
      background: var(--bg-main);
    }

    .okr-menu-item.danger {
      color: var(--danger);
    }

    .okr-menu-item.danger:hover {
      background: var(--danger-light);
    }

    /* Progress Bar */
    .progress-section {
      margin: 12px 0;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 13px;
    }

    .progress-label {
      color: var(--text-secondary);
    }

    .progress-value {
      font-weight: 600;
      color: var(--text-primary);
    }

    .progress-bar {
      height: 8px;
      background: var(--bg-main);
      border-radius: 4px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.15s;
    }

    .progress-bar:hover {
      height: 10px;
    }

    .progress-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 4px;
      transition: width 0.3s ease, background 0.3s ease;
    }

    .progress-fill.success {
      background: var(--success);
    }

    .progress-fill.warning {
      background: var(--warning);
    }

    .progress-fill.danger {
      background: var(--danger);
    }

    /* KR List */
    .kr-list {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    .kr-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
    }

    .kr-item:last-child {
      border-bottom: none;
    }

    .kr-checkbox {
      width: 18px;
      height: 18px;
      border: 2px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      flex-shrink: 0;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 2px;
    }

    .kr-checkbox:hover {
      border-color: var(--primary);
    }

    .kr-checkbox.checked {
      background: var(--success);
      border-color: var(--success);
    }

    .kr-checkbox.checked::after {
      content: '';
      width: 8px;
      height: 4px;
      border: solid white;
      border-width: 0 0 2px 2px;
      transform: rotate(-45deg);
      margin-top: -1px;
    }

    .kr-content {
      flex: 1;
      min-width: 0;
    }

    .kr-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .kr-title.completed {
      text-decoration: line-through;
      color: var(--text-secondary);
    }

    .kr-meta {
      font-size: 12px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .kr-quick-update {
      padding: 2px 8px;
      background: var(--primary-light);
      color: var(--primary);
      border-radius: 4px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .kr-quick-update:hover {
      background: var(--primary);
      color: white;
    }

    /* OKR Status Badge */
    .okr-status {
      position: absolute;
      top: 20px;
      right: 60px;
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 500;
    }

    .okr-status.on-track {
      background: var(--success-light);
      color: var(--success);
    }

    .okr-status.at-risk {
      background: var(--warning-light);
      color: var(--warning);
    }

    .okr-status.off-track {
      background: var(--danger-light);
      color: var(--danger);
    }

    /* ========== Modal ========== */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s;
    }

    .modal-backdrop.show {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: white;
      border-radius: 16px;
      box-shadow: var(--shadow-xl);
      width: 90%;
      max-width: 650px;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transform: scale(0.95);
      transition: all 0.2s;
    }

    .modal-backdrop.show .modal {
      transform: scale(1);
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-secondary);
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }

    .modal-close:hover {
      background: var(--bg-main);
      color: var(--text-primary);
    }

    .modal-body {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Wizard Steps */
    .wizard-progress {
      margin-bottom: 24px;
    }

    .wizard-steps {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .wizard-step {
      flex: 1;
      height: 4px;
      background: var(--bg-main);
      border-radius: 2px;
      transition: all 0.3s;
    }

    .wizard-step.active {
      background: var(--primary);
    }

    .wizard-step.completed {
      background: var(--success);
    }

    .wizard-step-label {
      text-align: center;
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 8px;
    }

    /* Form */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .form-label.required::after {
      content: '*';
      color: var(--danger);
      margin-left: 4px;
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      outline: none;
      transition: all 0.15s;
      font-family: inherit;
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-hint {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 6px;
    }

    .form-error {
      font-size: 13px;
      color: var(--danger);
      margin-top: 6px;
      display: none;
    }

    .form-error.show {
      display: block;
    }

    /* KR Form */
    .kr-form-item {
      background: var(--bg-main);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      position: relative;
    }

    .kr-form-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .kr-form-item-title {
      font-size: 14px;
      font-weight: 500;
    }

    .kr-form-item-remove {
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      border-radius: 4px;
      cursor: pointer;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }

    .kr-form-item-remove:hover {
      background: var(--danger-light);
      color: var(--danger);
    }

    .kr-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    /* Period Selector */
    .period-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .period-option {
      flex: 1;
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.15s;
      font-size: 14px;
      font-weight: 500;
    }

    .period-option:hover {
      border-color: var(--primary);
      background: var(--primary-light);
    }

    .period-option.selected {
      border-color: var(--primary);
      background: var(--primary-light);
      color: var(--primary);
    }

    /* ========== Side Panel ========== */
    .side-panel-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.3);
      z-index: 900;
      opacity: 0;
      visibility: hidden;
      transition: all 0.25s;
    }

    .side-panel-backdrop.show {
      opacity: 1;
      visibility: visible;
    }

    .side-panel {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 500px;
      max-width: 90vw;
      background: white;
      box-shadow: var(--shadow-xl);
      z-index: 901;
      transform: translateX(100%);
      transition: transform 0.25s ease;
      display: flex;
      flex-direction: column;
    }

    .side-panel.show {
      transform: translateX(0);
    }

    .side-panel-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .side-panel-body {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .side-panel-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* ========== Popover ========== */
    .popover {
      position: fixed;
      background: white;
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border);
      padding: 16px;
      z-index: 800;
      min-width: 280px;
      display: none;
    }

    .popover.show {
      display: block;
      animation: popoverFadeIn 0.15s ease;
    }

    @keyframes popoverFadeIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .popover-header {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text-primary);
    }

    .popover-slider {
      width: 100%;
      margin: 16px 0;
    }

    .popover-input-group {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .popover-input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 14px;
      width: 80px;
    }

    .popover-textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 13px;
      resize: vertical;
      min-height: 60px;
      font-family: inherit;
      margin-bottom: 12px;
    }

    /* ========== Confirm Dialog ========== */
    .confirm-dialog {
      text-align: center;
      padding: 20px;
    }

    .confirm-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .confirm-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .confirm-message {
      color: var(--text-secondary);
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .confirm-impact {
      background: var(--bg-main);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 20px;
      text-align: left;
      font-size: 14px;
    }

    .confirm-impact-title {
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--warning);
    }

    .confirm-impact-list {
      list-style: none;
      padding: 0;
    }

    .confirm-impact-list li {
      padding: 4px 0;
      padding-left: 20px;
      position: relative;
    }

    .confirm-impact-list li::before {
      content: 'â€¢';
      position: absolute;
      left: 8px;
      color: var(--text-secondary);
    }

    .confirm-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    /* ========== Inline Form ========== */
    .inline-form {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .inline-form.show {
      max-height: 500px;
    }

    .inline-form-inner {
      padding: 16px;
      background: var(--bg-main);
      border-radius: 8px;
      margin-top: 12px;
    }

    /* ========== Toast ========== */
    .toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 1100;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .toast {
      background: white;
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      border-left: 4px solid var(--primary);
      animation: toastSlideIn 0.3s ease;
    }

    @keyframes toastSlideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast.success {
      border-left-color: var(--success);
    }

    .toast.error {
      border-left-color: var(--danger);
    }

    .toast-content {
      flex: 1;
    }

    .toast-title {
      font-weight: 500;
      font-size: 14px;
      margin-bottom: 2px;
    }

    .toast-message {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .toast-undo {
      padding: 6px 12px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
    }

    /* ========== Responsive ========== */
    @media (max-width: 768px) {
      .okr-grid {
        grid-template-columns: 1fr;
      }

      .side-panel {
        width: 100%;
      }

      .kr-form-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ========== Empty State ========== */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .empty-message {
      font-size: 14px;
      margin-bottom: 20px;
    }

    /* ========== Helpers ========== */
    .hidden {
      display: none !important;
    }

    .text-sm {
      font-size: 13px;
    }

    .text-muted {
      color: var(--text-secondary);
    }

    .mt-2 { margin-top: 8px; }
    .mt-4 { margin-top: 16px; }
    .mb-2 { margin-bottom: 8px; }
    .mb-4 { margin-bottom: 16px; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <span>ğŸ¯</span>
          <span>Lumina OKR</span>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" onclick="showDemoInfo()">
            <span>ğŸ’¡</span>
            <span>äº¤äº’è¯´æ˜</span>
          </button>
          <button class="btn btn-primary" onclick="openCreateOKRModal()">
            <span>+</span>
            <span>æ–°å»º OKR</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">æˆ‘çš„ç›®æ ‡</h1>
      <p class="page-subtitle">è¿½è¸ªä½ çš„ç›®æ ‡ï¼ŒæŠŠæ„¿æ™¯å˜æˆç°å®</p>
    </div>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab active" onclick="filterOKR('all')">å…¨éƒ¨</button>
      <button class="tab" onclick="filterOKR('yearly')">å¹´åº¦</button>
      <button class="tab" onclick="filterOKR('quarterly')">å­£åº¦</button>
      <button class="tab" onclick="filterOKR('monthly')">æœˆåº¦</button>
    </nav>

    <!-- OKR Grid -->
    <div class="okr-grid" id="okrGrid">
      <!-- OKR Cards will be rendered here -->
    </div>
  </div>

  <!-- ========== Create OKR Modal (Wizard) ========== -->
  <div class="modal-backdrop" id="createOKRModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="wizardTitle">åˆ›å»º OKR</h2>
        <button class="modal-close" onclick="closeCreateOKRModal()">Ã—</button>
      </div>

      <div class="modal-body">
        <!-- Wizard Progress -->
        <div class="wizard-progress">
          <div class="wizard-steps">
            <div class="wizard-step active" data-step="1"></div>
            <div class="wizard-step" data-step="2"></div>
            <div class="wizard-step" data-step="3"></div>
          </div>
          <div class="wizard-step-label" id="wizardStepLabel">æ­¥éª¤ 1/3ï¼šé€‰æ‹©å‘¨æœŸ</div>
        </div>

        <!-- Step 1: Period -->
        <div class="wizard-step-content" data-step="1">
          <div class="form-group">
            <label class="form-label required">ç›®æ ‡å‘¨æœŸ</label>
            <div class="period-selector">
              <div class="period-option" data-value="yearly" onclick="selectPeriod('yearly')">
                <div style="font-size: 24px; margin-bottom: 4px;">ğŸ“…</div>
                <div>å¹´åº¦</div>
              </div>
              <div class="period-option selected" data-value="quarterly" onclick="selectPeriod('quarterly')">
                <div style="font-size: 24px; margin-bottom: 4px;">ğŸ“Š</div>
                <div>å­£åº¦</div>
              </div>
              <div class="period-option" data-value="monthly" onclick="selectPeriod('monthly')">
                <div style="font-size: 24px; margin-bottom: 4px;">ğŸ“†</div>
                <div>æœˆåº¦</div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label required">å‘¨æœŸæ—¶é—´</label>
            <input type="text" class="form-input" id="okrPeriodValue" placeholder="ä¾‹å¦‚ï¼š2024-Q1" value="2024-Q1">
            <div class="form-hint">ç³»ç»Ÿä¼šæ ¹æ®å½“å‰æ—¶é—´è‡ªåŠ¨æ¨è</div>
          </div>
        </div>

        <!-- Step 2: Objective -->
        <div class="wizard-step-content hidden" data-step="2">
          <div class="form-group">
            <label class="form-label required">ç›®æ ‡æ ‡é¢˜</label>
            <input type="text" class="form-input" id="okrTitle" placeholder="ä¾‹å¦‚ï¼šæˆä¸ºå…¨æ ˆå¼€å‘è€…">
            <div class="form-hint">ä¸€ä¸ªå¥½çš„ç›®æ ‡åº”è¯¥æ˜¯å®šæ€§ã€æ¿€åŠ±æ€§çš„</div>
            <div class="form-error" id="okrTitleError">è¯·è¾“å…¥ç›®æ ‡æ ‡é¢˜</div>
          </div>

          <div class="form-group">
            <label class="form-label">ç›®æ ‡æè¿°</label>
            <textarea class="form-textarea" id="okrDescription" placeholder="æè¿°ä½ ä¸ºä»€ä¹ˆæƒ³å®ç°è¿™ä¸ªç›®æ ‡ï¼Œä»¥åŠå®ƒå¯¹ä½ çš„æ„ä¹‰..."></textarea>
            <div class="form-hint">å¸®åŠ©ä½ è®°ä½ç›®æ ‡èƒŒåçš„åŠ¨æœº</div>
          </div>

          <div class="form-group">
            <label class="form-label">é€‰æ‹©å›¾æ ‡</label>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <button type="button" class="btn btn-ghost btn-sm icon-option" onclick="selectIcon('ğŸš€')">ğŸš€</button>
              <button type="button" class="btn btn-ghost btn-sm icon-option" onclick="selectIcon('ğŸ“š')">ğŸ“š</button>
              <button type="button" class="btn btn-ghost btn-sm icon-option" onclick="selectIcon('ğŸ’ª')">ğŸ’ª</button>
              <button type="button" class="btn btn-ghost btn-sm icon-option" onclick="selectIcon('ğŸ¨')">ğŸ¨</button>
              <button type="button" class="btn btn-ghost btn-sm icon-option" onclick="selectIcon('ğŸ’¼')">ğŸ’¼</button>
              <button type="button" class="btn btn-ghost btn-sm icon-option" onclick="selectIcon('ğŸŒŸ')">ğŸŒŸ</button>
              <button type="button" class="btn btn-ghost btn-sm icon-option" onclick="selectIcon('ğŸƒ')">ğŸƒ</button>
              <button type="button" class="btn btn-ghost btn-sm icon-option" onclick="selectIcon('ğŸ¯')">ğŸ¯</button>
            </div>
            <input type="hidden" id="okrIcon" value="ğŸ¯">
          </div>
        </div>

        <!-- Step 3: Key Results -->
        <div class="wizard-step-content hidden" data-step="3">
          <div class="form-group">
            <label class="form-label required">å…³é”®ç»“æœ</label>
            <div class="form-hint mb-4">å…³é”®ç»“æœåº”è¯¥æ˜¯å¯é‡åŒ–çš„æŒ‡æ ‡ï¼Œå»ºè®® 3-5 ä¸ª</div>
            <div id="krFormList">
              <!-- KR Form Items will be added here -->
            </div>
            <button type="button" class="btn btn-secondary btn-sm" onclick="addKRForm()" style="width: 100%; justify-content: center; margin-top: 8px;">
              <span>+</span>
              <span>æ·»åŠ å…³é”®ç»“æœ</span>
            </button>
          </div>
        </div>

        <!-- Preview -->
        <div class="wizard-step-content hidden" data-step="preview">
          <div style="background: var(--bg-main); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 12px;" id="previewTitle">OKR é¢„è§ˆ</h3>
            <div id="previewContent"></div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-ghost" id="wizardPrevBtn" onclick="wizardPrev()" disabled>ä¸Šä¸€æ­¥</button>
        <button type="button" class="btn btn-primary" id="wizardNextBtn" onclick="wizardNext()">ä¸‹ä¸€æ­¥</button>
        <button type="button" class="btn btn-primary hidden" id="wizardCreateBtn" onclick="createOKR()">åˆ›å»º OKR</button>
      </div>
    </div>
  </div>

  <!-- ========== Side Panel (Edit OKR) ========== -->
  <div class="side-panel-backdrop" id="sidePanelBackdrop" onclick="closeSidePanel()"></div>
  <div class="side-panel" id="editSidePanel">
    <div class="side-panel-header">
      <h2 class="modal-title">ç¼–è¾‘ OKR</h2>
      <button class="modal-close" onclick="closeSidePanel()">Ã—</button>
    </div>
    <div class="side-panel-body">
      <div class="form-group">
        <label class="form-label required">ç›®æ ‡æ ‡é¢˜</label>
        <input type="text" class="form-input" id="editOKRTitle">
      </div>

      <div class="form-group">
        <label class="form-label">ç›®æ ‡æè¿°</label>
        <textarea class="form-textarea" id="editOKRDescription"></textarea>
      </div>

      <div class="form-group">
        <label class="form-label">å‘¨æœŸæ—¶é—´</label>
        <input type="text" class="form-input" id="editOKRPeriod">
      </div>

      <div style="border-top: 1px solid var(--border); padding-top: 20px; margin-top: 20px;">
        <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">å…³é”®ç»“æœ</h4>
        <div id="editKRList"></div>
      </div>
    </div>
    <div class="side-panel-footer">
      <button type="button" class="btn btn-ghost" onclick="closeSidePanel()">å–æ¶ˆ</button>
      <button type="button" class="btn btn-primary" onclick="saveOKREdit()">ä¿å­˜</button>
    </div>
  </div>

  <!-- ========== Progress Update Popover ========== -->
  <div class="popover" id="progressPopover">
    <div class="popover-header" id="popoverTitle">æ›´æ–°è¿›åº¦</div>
    <input type="range" class="popover-slider" id="progressSlider" min="0" max="100" value="0">
    <div class="popover-input-group">
      <span style="font-size: 13px; color: var(--text-secondary);">å½“å‰å€¼:</span>
      <input type="number" class="popover-input" id="progressValue" value="0">
      <span style="font-size: 13px; color: var(--text-secondary);" id="progressTarget">/ 100</span>
    </div>
    <textarea class="popover-textarea" id="progressNote" placeholder="æ·»åŠ æ›´æ–°å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰..."></textarea>
    <div style="display: flex; gap: 8px;">
      <button type="button" class="btn btn-secondary btn-sm" style="flex: 1;" onclick="closeProgressPopover()">å–æ¶ˆ</button>
      <button type="button" class="btn btn-primary btn-sm" style="flex: 1;" onclick="saveProgress()">æ›´æ–°</button>
    </div>
  </div>

  <!-- ========== Delete Confirm Dialog ========== -->
  <div class="modal-backdrop" id="deleteModal">
    <div class="modal" style="max-width: 450px;">
      <div class="modal-body">
        <div class="confirm-dialog">
          <div class="confirm-icon">âš ï¸</div>
          <h3 class="confirm-title" id="deleteTitle">åˆ é™¤ OKR</h3>
          <div class="confirm-message" id="deleteMessage">ç¡®å®šè¦åˆ é™¤è¿™ä¸ª OKR å—ï¼Ÿ</div>
          <div class="confirm-impact hidden" id="deleteImpact">
            <div class="confirm-impact-title">å°†åŒæ—¶åˆ é™¤ï¼š</div>
            <ul class="confirm-impact-list" id="deleteImpactList"></ul>
          </div>
          <div class="confirm-actions">
            <button type="button" class="btn btn-ghost" onclick="closeDeleteModal()">å–æ¶ˆ</button>
            <button type="button" class="btn btn-danger" onclick="confirmDelete()">åˆ é™¤</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== Toast Container ========== -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
    // ========== Data Store ==========
    let okrs = [
      {
        id: 1,
        title: '2024å¹´æˆä¸ºå…¨æ ˆå¼€å‘è€…',
        description: 'æŒæ¡å‰åç«¯å¼€å‘æŠ€èƒ½ï¼Œèƒ½å¤Ÿç‹¬ç«‹å®Œæˆå®Œæ•´çš„ Web åº”ç”¨',
        period: 'yearly',
        periodValue: '2024',
        icon: 'ğŸš€',
        progress: 35,
        status: 'on-track',
        krs: [
          { id: 1, title: 'å®Œæˆ 10 ä¸ªå¼€æºé¡¹ç›®è´¡çŒ®', target: 10, current: 3, unit: 'ä¸ª', completed: false },
          { id: 2, title: 'å­¦ä¹ å¹¶æŒæ¡ 5 ä¸ªåç«¯æ¡†æ¶', target: 5, current: 2, unit: 'ä¸ª', completed: false },
          { id: 3, title: 'éƒ¨ç½² 3 ä¸ªç”Ÿäº§çº§é¡¹ç›®', target: 3, current: 1, unit: 'ä¸ª', completed: false }
        ]
      },
      {
        id: 2,
        title: 'å»ºç«‹ä¸ªäººçŸ¥è¯†ä½“ç³»',
        description: 'é€šè¿‡æŒç»­å­¦ä¹ å’Œè¾“å‡ºï¼Œæ„å»ºå®Œæ•´çš„çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ',
        period: 'quarterly',
        periodValue: '2024-Q1',
        icon: 'ğŸ“š',
        progress: 60,
        status: 'at-risk',
        krs: [
          { id: 1, title: 'é˜…è¯» 12 æœ¬æŠ€æœ¯ä¹¦ç±', target: 12, current: 8, unit: 'æœ¬', completed: false },
          { id: 2, title: 'å†™ 24 ç¯‡æŠ€æœ¯åšå®¢', target: 24, current: 12, unit: 'ç¯‡', completed: false },
          { id: 3, title: 'å»ºç«‹ä¸ªäºº Wiki çŸ¥è¯†åº“', target: 1, current: 1, unit: 'ä¸ª', completed: true }
        ]
      },
      {
        id: 3,
        title: 'ä¿æŒå¥åº·ç”Ÿæ´»æ–¹å¼',
        description: 'é€šè¿‡è§„å¾‹è¿åŠ¨å’Œå¥åº·é¥®é£Ÿï¼Œä¿æŒèº«ä½“å’Œå¿ƒç†çš„å¥åº·',
        period: 'quarterly',
        periodValue: '2024-Q1',
        icon: 'ğŸ’ª',
        progress: 80,
        status: 'on-track',
        krs: [
          { id: 1, title: 'æ¯å‘¨è¿åŠ¨ 4 æ¬¡', target: 48, current: 40, unit: 'æ¬¡', completed: false },
          { id: 2, title: 'å‡é‡ 5 å…¬æ–¤', target: 5, current: 4, unit: 'kg', completed: false },
          { id: 3, title: 'æ¯å¤©ç¡å¤Ÿ 7 å°æ—¶', target: 90, current: 85, unit: 'å¤©', completed: false }
        ]
      }
    ];

    let currentWizardStep = 1;
    let selectedPeriod = 'quarterly';
    let selectedIcon = 'ğŸ¯';
    let currentEditingOKR = null;
    let currentUpdatingKR = null;
    let deletingOKR = null;
    let currentFilter = 'all';

    // ========== Render Functions ==========
    function renderOKRs() {
      const grid = document.getElementById('okrGrid');
      const filteredOKRs = currentFilter === 'all'
        ? okrs
        : okrs.filter(okr => okr.period === currentFilter);

      if (filteredOKRs.length === 0) {
        grid.innerHTML = `
          <div class="empty-state" style="grid-column: 1/-1;">
            <div class="empty-icon">ğŸ“‹</div>
            <div class="empty-title">æš‚æ—  OKR</div>
            <div class="empty-message">ç‚¹å‡»å³ä¸Šè§’"æ–°å»º OKR"å¼€å§‹åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªç›®æ ‡</div>
          </div>
        `;
        return;
      }

      grid.innerHTML = filteredOKRs.map(okr => {
        const statusClass = okr.status;
        const statusText = {
          'on-track': 'æ­£å¸¸',
          'at-risk': 'æœ‰é£é™©',
          'off-track': 'è½å'
        }[okr.status];

        const progressColor = okr.progress >= 80 ? 'success' : okr.progress >= 50 ? '' : 'warning';

        return `
          <div class="okr-card" data-id="${okr.id}">
            <span class="okr-status ${statusClass}">${statusText}</span>
            <div class="okr-card-header">
              <div class="okr-title-wrapper">
                <div class="okr-title" contenteditable="false" onblur="handleInlineEdit(${okr.id}, this)" onclick="startInlineEdit(this)">${okr.icon} ${okr.title}</div>
                <span class="okr-period">${okr.periodValue}</span>
              </div>
              <div class="okr-menu">
                <button class="okr-menu-btn" onclick="toggleOKRMenu(${okr.id})">â‹®</button>
                <div class="okr-menu-dropdown" id="okrMenu${okr.id}">
                  <div class="okr-menu-item" onclick="openEditSidePanel(${okr.id})">
                    <span>âœï¸</span>
                    <span>ç¼–è¾‘</span>
                  </div>
                  <div class="okr-menu-item" onclick="duplicateOKR(${okr.id})">
                    <span>ğŸ“‹</span>
                    <span>å¤åˆ¶</span>
                  </div>
                  <div class="okr-menu-item danger" onclick="openDeleteModal(${okr.id})">
                    <span>ğŸ—‘ï¸</span>
                    <span>åˆ é™¤</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="progress-section">
              <div class="progress-header">
                <span class="progress-label">æ•´ä½“è¿›åº¦</span>
                <span class="progress-value">${okr.progress}%</span>
              </div>
              <div class="progress-bar" onclick="openQuickProgress(${okr.id})">
                <div class="progress-fill ${progressColor}" style="width: ${okr.progress}%"></div>
              </div>
            </div>

            <div class="kr-list">
              ${okr.krs.map(kr => `
                <div class="kr-item">
                  <div class="kr-checkbox ${kr.completed ? 'checked' : ''}" onclick="toggleKRComplete(${okr.id}, ${kr.id})"></div>
                  <div class="kr-content">
                    <div class="kr-title ${kr.completed ? 'completed' : ''}">${kr.title}</div>
                    <div class="kr-meta">
                      <span>${kr.current}/${kr.target} ${kr.unit}</span>
                      <span class="kr-quick-update" onclick="openKRProgress(${okr.id}, ${kr.id}, event)">æ›´æ–°è¿›åº¦</span>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>

            <!-- Inline Add KR Form -->
            <div class="inline-form" id="inlineAddKR${okr.id}">
              <div class="inline-form-inner">
                <input type="text" class="form-input mb-2" placeholder="å…³é”®ç»“æœæ ‡é¢˜" id="newKRTitle${okr.id}">
                <div class="kr-form-grid">
                  <input type="number" class="form-input" placeholder="ç›®æ ‡å€¼" id="newKRTarget${okr.id}">
                  <input type="text" class="form-input" placeholder="å•ä½" id="newKRUnit${okr.id}">
                </div>
                <div style="display: flex; gap: 8px; margin-top: 12px;">
                  <button type="button" class="btn btn-primary btn-sm" onclick="addNewKR(${okr.id})">æ·»åŠ </button>
                  <button type="button" class="btn btn-ghost btn-sm" onclick="toggleInlineAddKR(${okr.id})">å–æ¶ˆ</button>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // ========== OKR Card Interactions ==========
    function toggleOKRMenu(id) {
      event.stopPropagation();
      const menu = document.getElementById(`okrMenu${id}`);
      document.querySelectorAll('.okr-menu-dropdown').forEach(m => {
        if (m !== menu) m.classList.remove('show');
      });
      menu.classList.toggle('show');
    }

    // Close menus when clicking outside
    document.addEventListener('click', () => {
      document.querySelectorAll('.okr-menu-dropdown').forEach(m => m.classList.remove('show'));
    });

    // Inline Edit Title
    function startInlineEdit(element) {
      element.contentEditable = true;
      element.focus();
      // Select all text
      document.execCommand('selectAll', false, null);
      element.classList.add('editing');
    }

    function handleInlineEdit(okrId, element) {
      element.contentEditable = false;
      element.classList.remove('editing');
      const newTitle = element.textContent.trim();
      if (newTitle && newTitle !== element.dataset.original) {
        const okr = okrs.find(o => o.id === okrId);
        if (okr) {
          const oldTitle = okr.title;
          okr.title = newTitle;
          showToast('success', 'å·²æ›´æ–°', `ç›®æ ‡æ ‡é¢˜å·²ä»"${oldTitle}"æ”¹ä¸º"${newTitle}"`, () => {
            okr.title = oldTitle;
            renderOKRs();
          });
        }
      }
      renderOKRs();
    }

    function toggleKRComplete(okrId, krId) {
      const okr = okrs.find(o => o.id === okrId);
      const kr = okr.krs.find(k => k.id === krId);
      kr.completed = !kr.completed;
      recalculateOKRProgress(okr);
      renderOKRs();
    }

    function recalculateOKRProgress(okr) {
      const total = okr.krs.length;
      const completed = okr.krs.filter(kr => kr.completed).length;
      okr.progress = Math.round((completed / total) * 100);
    }

    function toggleInlineAddKR(okrId) {
      const form = document.getElementById(`inlineAddKR${okrId}`);
      form.classList.toggle('show');
      if (form.classList.contains('show')) {
        document.getElementById(`newKRTitle${okrId}`).focus();
      }
    }

    function addNewKR(okrId) {
      const title = document.getElementById(`newKRTitle${okrId}`).value.trim();
      const target = document.getElementById(`newKRTarget${okrId}`).value;
      const unit = document.getElementById(`newKRUnit${okrId}`).value.trim() || 'ä¸ª';

      if (!title || !target) {
        showToast('error', 'æ·»åŠ å¤±è´¥', 'è¯·å¡«å†™å®Œæ•´çš„ KR ä¿¡æ¯');
        return;
      }

      const okr = okrs.find(o => o.id === okrId);
      okr.krs.push({
        id: Date.now(),
        title,
        target: parseInt(target),
        current: 0,
        unit,
        completed: false
      });

      renderOKRs();
      showToast('success', 'æ·»åŠ æˆåŠŸ', 'å…³é”®ç»“æœå·²æ·»åŠ ');
    }

    // ========== Create OKR Wizard ==========
    function openCreateOKRModal() {
      currentWizardStep = 1;
      selectedPeriod = 'quarterly';
      selectedIcon = 'ğŸ¯';
      document.getElementById('createOKRModal').classList.add('show');
      document.getElementById('okrPeriodValue').value = '2024-Q1';
      document.getElementById('okrTitle').value = '';
      document.getElementById('okrDescription').value = '';
      updateWizardUI();
      initKRForms();
    }

    function closeCreateOKRModal() {
      document.getElementById('createOKRModal').classList.remove('show');
    }

    function selectPeriod(period) {
      selectedPeriod = period;
      document.querySelectorAll('.period-option').forEach(opt => opt.classList.remove('selected'));
      document.querySelector(`.period-option[data-value="${period}"]`).classList.add('selected');

      const periodMap = {
        'yearly': '2024',
        'quarterly': '2024-Q1',
        'monthly': '2024-01'
      };
      document.getElementById('okrPeriodValue').value = periodMap[period];
    }

    function selectIcon(icon) {
      selectedIcon = icon;
      document.getElementById('okrIcon').value = icon;
      document.querySelectorAll('.icon-option').forEach(btn => {
        btn.classList.remove('btn-primary');
        btn.classList.add('btn-ghost');
      });
      event.target.classList.remove('btn-ghost');
      event.target.classList.add('btn-primary');
    }

    function wizardNext() {
      if (currentWizardStep === 2) {
        const title = document.getElementById('okrTitle').value.trim();
        if (!title) {
          document.getElementById('okrTitleError').classList.add('show');
          return;
        }
        document.getElementById('okrTitleError').classList.remove('show');
      }

      if (currentWizardStep < 3) {
        currentWizardStep++;
        updateWizardUI();
      } else {
        showPreview();
      }
    }

    function wizardPrev() {
      if (currentWizardStep > 1) {
        currentWizardStep--;
        updateWizardUI();
      }
    }

    function updateWizardUI() {
      // Update steps
      document.querySelectorAll('.wizard-step').forEach((step, index) => {
        step.classList.remove('active', 'completed');
        if (index + 1 < currentWizardStep) {
          step.classList.add('completed');
        } else if (index + 1 === currentWizardStep) {
          step.classList.add('active');
        }
      });

      // Update label
      const labels = {
        1: 'æ­¥éª¤ 1/3ï¼šé€‰æ‹©å‘¨æœŸ',
        2: 'æ­¥éª¤ 2/3ï¼šè®¾å®šç›®æ ‡',
        3: 'æ­¥éª¤ 3/3ï¼šè®¾å®šå…³é”®ç»“æœ'
      };
      document.getElementById('wizardStepLabel').textContent = labels[currentWizardStep];

      // Show/hide content
      document.querySelectorAll('.wizard-step-content').forEach(content => {
        content.classList.add('hidden');
      });
      document.querySelector(`.wizard-step-content[data-step="${currentWizardStep}"]`).classList.remove('hidden');

      // Update buttons
      document.getElementById('wizardPrevBtn').disabled = currentWizardStep === 1;
      document.getElementById('wizardNextBtn').classList.toggle('hidden', currentWizardStep === 3);
      document.getElementById('wizardCreateBtn').classList.toggle('hidden', currentWizardStep !== 3);
    }

    function initKRForms() {
      const krList = document.getElementById('krFormList');
      krList.innerHTML = '';
      // Add 3 default KR forms
      for (let i = 0; i < 3; i++) {
        addKRForm();
      }
    }

    function addKRForm() {
      const krList = document.getElementById('krFormList');
      const id = Date.now();
      const html = `
        <div class="kr-form-item" id="krForm${id}">
          <div class="kr-form-item-header">
            <span class="kr-form-item-title">å…³é”®ç»“æœ ${krList.children.length + 1}</span>
            <button type="button" class="kr-form-item-remove" onclick="removeKRForm(${id})">Ã—</button>
          </div>
          <div class="form-group" style="margin-bottom: 12px;">
            <input type="text" class="form-input kr-title-input" placeholder="ä¾‹å¦‚ï¼šå®Œæˆ 10 ä¸ªå¼€æºé¡¹ç›®è´¡çŒ®">
          </div>
          <div class="kr-form-grid">
            <div>
              <label class="form-label" style="font-size: 12px;">ç›®æ ‡å€¼</label>
              <input type="number" class="form-input kr-target-input" placeholder="10" value="10">
            </div>
            <div>
              <label class="form-label" style="font-size: 12px;">å•ä½</label>
              <input type="text" class="form-input kr-unit-input" placeholder="ä¸ª" value="ä¸ª">
            </div>
          </div>
        </div>
      `;
      krList.insertAdjacentHTML('beforeend', html);
    }

    function removeKRForm(id) {
      const form = document.getElementById(`krForm${id}`);
      form.remove();
      // Update titles
      document.querySelectorAll('.kr-form-item').forEach((item, index) => {
        item.querySelector('.kr-form-item-title').textContent = `å…³é”®ç»“æœ ${index + 1}`;
      });
    }

    function showPreview() {
      document.querySelectorAll('.wizard-step-content').forEach(content => {
        content.classList.add('hidden');
      });
      document.querySelector('.wizard-step-content[data-step="preview"]').classList.remove('hidden');

      const title = document.getElementById('okrTitle').value.trim();
      const description = document.getElementById('okrDescription').value.trim();
      const period = document.getElementById('okrPeriodValue').value.trim();

      let krsHTML = '';
      document.querySelectorAll('.kr-form-item').forEach(item => {
        const krTitle = item.querySelector('.kr-title-input').value.trim();
        const krTarget = item.querySelector('.kr-target-input').value;
        const krUnit = item.querySelector('.kr-unit-input').value.trim();
        if (krTitle && krTarget) {
          krsHTML += `
            <div style="padding: 8px 0; border-bottom: 1px solid var(--border);">
              <div style="font-size: 14px;">${krTitle}</div>
              <div style="font-size: 12px; color: var(--text-secondary);">0 / ${krTarget} ${krUnit}</div>
            </div>
          `;
        }
      });

      document.getElementById('previewContent').innerHTML = `
        <div style="font-size: 18px; font-weight: 600; margin-bottom: 4px;">${selectedIcon} ${title}</div>
        <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">${period}</div>
        ${description ? `<div style="font-size: 14px; margin-bottom: 16px;">${description}</div>` : ''}
        <div style="font-weight: 600; margin-bottom: 8px; font-size: 14px;">å…³é”®ç»“æœ</div>
        ${krsHTML || '<div style="color: var(--text-secondary); font-size: 14px;">æš‚æ— å…³é”®ç»“æœ</div>'}
      `;

      document.getElementById('wizardPrevBtn').classList.remove('hidden');
      document.getElementById('wizardCreateBtn').classList.remove('hidden');
      document.getElementById('wizardStepLabel').textContent = 'é¢„è§ˆ';
    }

    function createOKR() {
      const title = document.getElementById('okrTitle').value.trim();
      const description = document.getElementById('okrDescription').value.trim();
      const period = document.getElementById('okrPeriodValue').value.trim();

      if (!title) {
        showToast('error', 'åˆ›å»ºå¤±è´¥', 'è¯·è¾“å…¥ç›®æ ‡æ ‡é¢˜');
        return;
      }

      const krs = [];
      document.querySelectorAll('.kr-form-item').forEach(item => {
        const krTitle = item.querySelector('.kr-title-input').value.trim();
        const krTarget = parseInt(item.querySelector('.kr-target-input').value);
        const krUnit = item.querySelector('.kr-unit-input').value.trim() || 'ä¸ª';
        if (krTitle && krTarget) {
          krs.push({
            id: Date.now() + Math.random(),
            title: krTitle,
            target: krTarget,
            current: 0,
            unit: krUnit,
            completed: false
          });
        }
      });

      const newOKR = {
        id: Date.now(),
        title,
        description,
        period: selectedPeriod,
        periodValue: period,
        icon: selectedIcon,
        progress: 0,
        status: 'on-track',
        krs
      };

      okrs.unshift(newOKR);
      renderOKRs();
      closeCreateOKRModal();
      showToast('success', 'åˆ›å»ºæˆåŠŸ', `"${title}"å·²åˆ›å»ºï¼Œå¼€å§‹æ·»åŠ ä»»åŠ¡å§ï¼`);
    }

    // ========== Side Panel (Edit) ==========
    function openEditSidePanel(okrId) {
      currentEditingOKR = okrs.find(o => o.id === okrId);
      if (!currentEditingOKR) return;

      document.getElementById('editOKRTitle').value = currentEditingOKR.title;
      document.getElementById('editOKRDescription').value = currentEditingOKR.description || '';
      document.getElementById('editOKRPeriod').value = currentEditingOKR.periodValue;

      const krList = document.getElementById('editKRList');
      krList.innerHTML = currentEditingOKR.krs.map(kr => `
        <div class="kr-form-item">
          <div class="form-group" style="margin-bottom: 12px;">
            <input type="text" class="form-input edit-kr-title" value="${kr.title}" data-kr-id="${kr.id}">
          </div>
          <div class="kr-form-grid">
            <div>
              <label class="form-label" style="font-size: 12px;">å½“å‰å€¼</label>
              <input type="number" class="form-input edit-kr-current" value="${kr.current}" data-kr-id="${kr.id}">
            </div>
            <div>
              <label class="form-label" style="font-size: 12px;">ç›®æ ‡å€¼</label>
              <input type="number" class="form-input edit-kr-target" value="${kr.target}" data-kr-id="${kr.id}">
            </div>
          </div>
        </div>
      `).join('');

      document.getElementById('sidePanelBackdrop').classList.add('show');
      document.getElementById('editSidePanel').classList.add('show');
    }

    function closeSidePanel() {
      document.getElementById('sidePanelBackdrop').classList.remove('show');
      document.getElementById('editSidePanel').classList.remove('show');
      currentEditingOKR = null;
    }

    function saveOKREdit() {
      if (!currentEditingOKR) return;

      currentEditingOKR.title = document.getElementById('editOKRTitle').value.trim();
      currentEditingOKR.description = document.getElementById('editOKRDescription').value.trim();
      currentEditingOKR.periodValue = document.getElementById('editOKRPeriod').value.trim();

      document.querySelectorAll('.edit-kr-title').forEach(input => {
        const krId = parseFloat(input.dataset.krId);
        const kr = currentEditingOKR.krs.find(k => k.id === krId);
        if (kr) kr.title = input.value.trim();
      });

      document.querySelectorAll('.edit-kr-current').forEach(input => {
        const krId = parseFloat(input.dataset.krId);
        const kr = currentEditingOKR.krs.find(k => k.id === krId);
        if (kr) kr.current = parseFloat(input.value) || 0;
      });

      document.querySelectorAll('.edit-kr-target').forEach(input => {
        const krId = parseFloat(input.dataset.krId);
        const kr = currentEditingOKR.krs.find(k => k.id === krId);
        if (kr) kr.target = parseFloat(input.value) || 1;
      });

      renderOKRs();
      closeSidePanel();
      showToast('success', 'ä¿å­˜æˆåŠŸ', 'OKR å·²æ›´æ–°');
    }

    // ========== Progress Popover ==========
    function openKRProgress(okrId, krId, event) {
      event.stopPropagation();
      const okr = okrs.find(o => o.id === okrId);
      const kr = okr.krs.find(k => k.id === krId);
      currentUpdatingKR = { okrId, krId, kr, okr };

      const popover = document.getElementById('progressPopover');
      const rect = event.target.getBoundingClientRect();
      popover.style.top = `${rect.bottom + 8}px`;
      popover.style.left = `${rect.left - 100}px`;

      document.getElementById('popoverTitle').textContent = kr.title.substring(0, 20) + '...';
      document.getElementById('progressSlider').max = kr.target;
      document.getElementById('progressSlider').value = kr.current;
      document.getElementById('progressValue').value = kr.current;
      document.getElementById('progressTarget').textContent = `/ ${kr.target} ${kr.unit}`;
      document.getElementById('progressNote').value = '';

      popover.classList.add('show');
    }

    function openQuickProgress(okrId) {
      const okr = okrs.find(o => o.id === okrId);
      const card = document.querySelector(`.okr-card[data-id="${okrId}"]`);
      const rect = card.getBoundingClientRect();

      const popover = document.getElementById('progressPopover');
      popover.style.top = `${rect.top + 100}px`;
      popover.style.left = `${rect.left + 20}px`;

      document.getElementById('popoverTitle').textContent = `æ›´æ–° ${okr.title.substring(0, 15)}...`;
      document.getElementById('progressSlider').max = 100;
      document.getElementById('progressSlider').value = okr.progress;
      document.getElementById('progressValue').value = okr.progress;
      document.getElementById('progressTarget').textContent = '/ 100 %';
      document.getElementById('progressNote').value = '';

      currentUpdatingKR = { okrId, okr, isOverall: true };

      popover.classList.add('show');
    }

    function closeProgressPopover() {
      document.getElementById('progressPopover').classList.remove('show');
      currentUpdatingKR = null;
    }

    document.getElementById('progressSlider').addEventListener('input', function() {
      document.getElementById('progressValue').value = this.value;
    });

    document.getElementById('progressValue').addEventListener('input', function() {
      document.getElementById('progressSlider').value = this.value;
    });

    function saveProgress() {
      if (!currentUpdatingKR) return;

      const value = parseInt(document.getElementById('progressValue').value) || 0;
      const note = document.getElementById('progressNote').value.trim();

      if (currentUpdatingKR.isOverall) {
        currentUpdatingKR.okr.progress = Math.min(100, Math.max(0, value));
      } else {
        currentUpdatingKR.kr.current = value;
        currentUpdatingKR.kr.completed = value >= currentUpdatingKR.kr.target;
        recalculateOKRProgress(currentUpdatingKR.okr);
      }

      renderOKRs();
      closeProgressPopover();
      showToast('success', 'è¿›åº¦å·²æ›´æ–°', note || 'ç»§ç»­ä¿æŒï¼', null);
    }

    // ========== Delete ==========
    function openDeleteModal(okrId) {
      deletingOKR = okrs.find(o => o.id === okrId);
      if (!deletingOKR) return;

      const activeKRs = deletingOKR.krs.filter(kr => !kr.completed).length;
      const totalKRs = deletingOKR.krs.length;

      document.getElementById('deleteTitle').textContent = activeKRs > 0 ? 'å–æ¶ˆ OKR' : 'åˆ é™¤ OKR';
      document.getElementById('deleteMessage').textContent = activeKRs > 0
        ? `æ­¤ OKR æœ‰ ${activeKRs} ä¸ªè¿›è¡Œä¸­çš„å…³é”®ç»“æœï¼Œç¡®å®šè¦å–æ¶ˆå—ï¼Ÿ`
        : 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ª OKR å—ï¼Ÿ';

      const impactDiv = document.getElementById('deleteImpact');
      const impactList = document.getElementById('deleteImpactList');

      if (activeKRs > 0 || totalKRs > 0) {
        impactDiv.classList.remove('hidden');
        impactList.innerHTML = `
          <li>${deletingOKR.krs.length} ä¸ªå…³é”®ç»“æœ</li>
          ${activeKRs > 0 ? `<li>${activeKRs} ä¸ªè¿›è¡Œä¸­çš„ä»»åŠ¡</li>` : ''}
        `;
      } else {
        impactDiv.classList.add('hidden');
      }

      document.getElementById('deleteModal').classList.add('show');
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.remove('show');
      deletingOKR = null;
    }

    function confirmDelete() {
      if (!deletingOKR) return;

      const index = okrs.findIndex(o => o.id === deletingOKR.id);
      if (index > -1) {
        okrs.splice(index, 1);
        renderOKRs();
        showToast('success', 'å·²åˆ é™¤', `"${deletingOKR.title}"å·²ç§»è‡³å›æ”¶ç«™ï¼Œ30 å¤©å†…å¯æ¢å¤`, () => {
          okrs.push(deletingOKR);
          renderOKRs();
        });
      }
      closeDeleteModal();
    }

    // ========== Duplicate ==========
    function duplicateOKR(okrId) {
      const okr = okrs.find(o => o.id === okrId);
      if (!okr) return;

      const newOKR = {
        ...okr,
        id: Date.now(),
        title: okr.title + ' (å‰¯æœ¬)',
        progress: 0,
        krs: okr.krs.map(kr => ({ ...kr, id: Date.now() + Math.random(), current: 0, completed: false }))
      };

      okrs.unshift(newOKR);
      renderOKRs();
      showToast('success', 'å¤åˆ¶æˆåŠŸ', `å·²åˆ›å»º"${okr.title}"çš„å‰¯æœ¬`);
    }

    // ========== Filter ==========
    function filterOKR(type) {
      currentFilter = type;
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      renderOKRs();
    }

    // ========== Toast ==========
    function showToast(type, title, message, onUndo) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <div class="toast-content">
          <div class="toast-title">${title}</div>
          <div class="toast-message">${message}</div>
        </div>
        ${onUndo ? '<button class="toast-undo">æ’¤é”€</button>' : ''}
      `;

      if (onUndo) {
        toast.querySelector('.toast-undo').addEventListener('click', () => {
          onUndo();
          toast.remove();
        });
      }

      container.appendChild(toast);

      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }

    // ========== Demo Info ==========
    function showDemoInfo() {
      const info = `
ğŸ¯ Lumina OKR äº¤äº’åŸå‹è¯´æ˜

ã€åˆ›å»º OKRã€‘
â€¢ ç‚¹å‡»å³ä¸Šè§’"æ–°å»º OKR"æŒ‰é’®
â€¢ ä½“éªŒåˆ†æ­¥å‘å¯¼ï¼ˆå‘¨æœŸ â†’ ç›®æ ‡ â†’ å…³é”®ç»“æœ â†’ é¢„è§ˆï¼‰

ã€ç¼–è¾‘ OKRã€‘
â€¢ ç‚¹å‡»æ ‡é¢˜å¯å†…è”ç¼–è¾‘
â€¢ ç‚¹å‡»èœå• â†’ ç¼–è¾‘æ‰“å¼€ä¾§è¾¹æ 

ã€æ›´æ–°è¿›åº¦ã€‘
â€¢ ç‚¹å‡»è¿›åº¦æ¡å¿«é€Ÿæ›´æ–°æ•´ä½“è¿›åº¦
â€¢ ç‚¹å‡» KR çš„"æ›´æ–°è¿›åº¦"æ›´æ–°å•ä¸ª KR

ã€åˆ é™¤ OKRã€‘
â€¢ ç‚¹å‡»èœå• â†’ åˆ é™¤
â€¢ æŸ¥çœ‹çº§è”å½±å“æç¤º

ã€å…¶ä»–äº¤äº’ã€‘
â€¢ ç‚¹å‡» KR å¤é€‰æ¡†æ ‡è®°å®Œæˆ
â€¢ Tab åˆ‡æ¢ç­›é€‰ä¸åŒå‘¨æœŸçš„ OKR
      `;
      alert(info);
    }

    // ========== Init ==========
    renderOKRs();

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeCreateOKRModal();
        closeSidePanel();
        closeProgressPopover();
        closeDeleteModal();
      }
    });
  </script>
</body>
</html>
