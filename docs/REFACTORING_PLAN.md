# Blinko é¡¹ç›®é‡æ„è®¡åˆ’

> åˆ›å»ºæ—¶é—´ï¼š2025-01-01
> çŠ¶æ€ï¼šè¿›è¡Œä¸­

## é¡¹ç›®æ¦‚è¿°

Lumina æ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªæ‰˜ç®¡ç¬”è®°åº”ç”¨ï¼Œå…·æœ‰ AI åŠŸèƒ½ï¼Œæ”¯æŒå¤šå¹³å°ï¼ˆWebã€æ¡Œé¢ Tauriã€ç§»åŠ¨ç«¯ï¼‰ã€‚

- **å‰ç«¯**ï¼šReact 18, TypeScript, Vite, TailwindCSS, MobX
- **åç«¯**ï¼šNode.js, Express, tRPC, Prisma ORM
- **æ•°æ®åº“**ï¼šPostgreSQL
- **åŒ…ç®¡ç†å™¨**ï¼šBun v1.2.8+

---

## å½“å‰ä»£ç è´¨é‡çŠ¶å†µ

### ä¸¥é‡é—®é¢˜ç»Ÿè®¡

| é—®é¢˜ç±»å‹ | æ•°é‡ | ä¸¥é‡ç¨‹åº¦ |
|----------|------|----------|
| `@ts-ignore` ä½¿ç”¨ | **72å¤„** | ğŸ”´ ä¸¥é‡ |
| `any` ç±»å‹ä½¿ç”¨ | **72ä¸ªæ–‡ä»¶** | ğŸ”´ ä¸¥é‡ |
| è¶…é•¿æ–‡ä»¶ï¼ˆ>500è¡Œï¼‰ | **4ä¸ªæ–‡ä»¶** | ğŸ”´ ä¸¥é‡ |
| RootStore ç›´æ¥è®¿é—® | **100+ å¤„** | ğŸ”´ ä¸¥é‡ |
| console.log/error | **64å¤„** | ğŸŸ¡ è­¦å‘Š |

### è¶…é•¿æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | è¡Œæ•° | é—®é¢˜ | è®¡åˆ’æ“ä½œ |
|------|------|------|----------|
| `server/routerTrpc/note.ts` | **1987è¡Œ** | è·¯ç”±+ä¸šåŠ¡é€»è¾‘æ··åˆ | æ‹†åˆ†ä¸º Router + Service + Repository |
| `app/src/store/luminaStore.tsx` | **1138è¡Œ** | å•ä¸ª Store èŒè´£è¿‡å¤š | æ‹†åˆ†ä¸ºå¤šä¸ªä¸“é—¨ Store |
| `app/src/components/Common/Iconify/icons.tsx` | **1461è¡Œ** | è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶ | æŒ‰å›¾æ ‡åˆ†ç±»æ‹†åˆ† |
| `app/src/components/LuminaSettings/HotkeySetting.tsx` | **689è¡Œ** | ç»„ä»¶è¿‡é•¿ | æ‹†åˆ†ä¸ºå­ç»„ä»¶ |

---

## é‡æ„é˜¶æ®µè§„åˆ’

### é˜¶æ®µ 1ï¼šæ¶æ„é‡æ„ï¼ˆ1-2å‘¨ï¼‰

#### 1.1 åç«¯ä¸‰å±‚æ¶æ„æ”¹é€ 

**ç›®æ ‡**ï¼šå°†ä¸šåŠ¡é€»è¾‘ä»è·¯ç”±å±‚åˆ†ç¦»

**å½“å‰æ¶æ„**ï¼š
```
Router Layer (è·¯ç”±+ä¸šåŠ¡é€»è¾‘æ··åœ¨ä¸€èµ·)
    â†“
Database
```

**ç›®æ ‡æ¶æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Router Layer  â”‚  è·¯ç”±å®šä¹‰ã€å‚æ•°éªŒè¯ã€æƒé™æ£€æŸ¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Service Layer  â”‚  ä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡åè°ƒã€å¤–éƒ¨æœåŠ¡è°ƒç”¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Repository Layerâ”‚  æ•°æ®è®¿é—®ã€Prisma æŸ¥è¯¢å°è£…
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
  Database
```

**å…·ä½“ä»»åŠ¡**ï¼š
- [ ] æ‹†åˆ† `server/routerTrpc/note.ts` (1987è¡Œ)
  - [ ] åˆ›å»º `server/services/noteService.ts`
  - [ ] åˆ›å»º `server/repositories/noteRepository.ts`
  - [ ] é‡æ„ `noteRouter` åªä¿ç•™è·¯ç”±å®šä¹‰

- [ ] åˆ›å»ºå…¶ä»– Service å±‚
  - [ ] `userService.ts`
  - [ ] `tagService.ts`
  - [ ] `attachmentService.ts`
  - [ ] `aiService.ts` (å·²å­˜åœ¨ï¼Œéœ€æ•´ç†)

**é¢„æœŸæ”¶ç›Š**ï¼š
- ä»£ç å¯æµ‹è¯•æ€§ â†‘ 80%
- ä»£ç å¯ç»´æŠ¤æ€§ â†‘ 60%
- ä¸šåŠ¡é€»è¾‘å¤ç”¨æ€§ â†‘ 70%

#### 1.2 å‰ç«¯ Store æ‹†åˆ†

**ç›®æ ‡**ï¼šå°†å¤§å‹ LuminaStore æ‹†åˆ†ä¸ºå¤šä¸ªä¸“é—¨çš„ Store

**å½“å‰é—®é¢˜**ï¼š
- `luminaStore.tsx` åŒ…å«ï¼šç¬”è®°ç®¡ç†ã€æ ‡ç­¾ç®¡ç†ã€ç¦»çº¿åŒæ­¥ã€å¼•ç”¨ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ç­‰
- 1138è¡Œä»£ç ï¼ŒèŒè´£ä¸æ¸…

**ç›®æ ‡ç»“æ„**ï¼š
```
app/src/store/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ NoteStore.ts        # ç¬”è®°æ ¸å¿ƒæ“ä½œ
â”‚   â”œâ”€â”€ TagStore.ts         # æ ‡ç­¾ç®¡ç†
â”‚   â”œâ”€â”€ AttachmentStore.ts  # é™„ä»¶ç®¡ç†
â”‚   â””â”€â”€ ReferenceStore.ts   # å¼•ç”¨ç®¡ç†
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ OfflineStore.ts     # ç¦»çº¿åŒæ­¥ï¼ˆå·²å­˜åœ¨ï¼‰
â”‚   â”œâ”€â”€ AIService.ts        # AI åŠŸèƒ½
â”‚   â””â”€â”€ ShareStore.ts       # åˆ†äº«åŠŸèƒ½
â””â”€â”€ luminaStore.tsx         # ä¸»å…¥å£ï¼Œç»„åˆä¸Šè¿° Store
```

**å…·ä½“ä»»åŠ¡**ï¼š
- [ ] åˆ›å»º `NoteStore` - ç¬”è®° CRUD
- [ ] åˆ›å»º `TagStore` - æ ‡ç­¾æ“ä½œ
- [ ] åˆ›å»º `AttachmentStore` - é™„ä»¶ç®¡ç†
- [ ] åˆ›å»º `ReferenceStore` - å¼•ç”¨ç®¡ç†
- [ ] é‡æ„ `LuminaStore` ä¸ºç»„åˆæ ¹

**é¢„æœŸæ”¶ç›Š**ï¼š
- å•ä¸€èŒè´£åŸåˆ™
- æ›´å®¹æ˜“æµ‹è¯•
- æ›´å¥½çš„ä»£ç å¤ç”¨

#### 1.3 ç»„ä»¶æ¨¡å—åŒ–

**ç›®æ ‡**ï¼šæ‹†åˆ†è¶…é•¿ç»„ä»¶

**å…·ä½“ä»»åŠ¡**ï¼š
- [ ] æ‹†åˆ† `HotkeySetting.tsx` (689è¡Œ)
  - [ ] åˆ›å»º `HotkeyList.tsx`
  - [ ] åˆ›å»º `HotkeyEditor.tsx`
  - [ ] åˆ›å»º `useHotkeyManager.ts`

**é¢„æœŸæ”¶ç›Š**ï¼š
- ç»„ä»¶å¯ç»´æŠ¤æ€§ â†‘ 50%
- ç»„ä»¶å¯å¤ç”¨æ€§ â†‘ 40%

---

### é˜¶æ®µ 2ï¼šç±»å‹å®‰å…¨æå‡ï¼ˆ1å‘¨ï¼‰

#### 2.1 å‡å°‘ç±»å‹æ–­è¨€

**ç›®æ ‡**ï¼šç§»é™¤æ‰€æœ‰ `@ts-ignore` å’Œå‡å°‘ `any` ä½¿ç”¨

**å…·ä½“ä»»åŠ¡**ï¼š
- [ ] ç§»é™¤ `app/src/store/user.ts` ä¸­çš„ 10å¤„ `@ts-ignore`
- [ ] ç§»é™¤ `app/src/store/standard/PromiseState.ts` ä¸­çš„ 11å¤„ `@ts-ignore`
- [ ] å®šä¹‰æ˜ç¡®çš„æ¥å£æ›¿æ¢ `any` ç±»å‹
- [ ] å¯ç”¨æ›´ä¸¥æ ¼çš„ TypeScript é…ç½®

**è®¡åˆ’åˆ›å»ºçš„ç±»å‹æ–‡ä»¶**ï¼š
```
app/src/types/
â”œâ”€â”€ note.types.ts        # ç¬”è®°ç›¸å…³ç±»å‹
â”œâ”€â”€ tag.types.ts         # æ ‡ç­¾ç›¸å…³ç±»å‹
â”œâ”€â”€ attachment.types.ts  # é™„ä»¶ç›¸å…³ç±»å‹
â”œâ”€â”€ api.types.ts         # API å“åº”ç±»å‹
â””â”€â”€ store.types.ts       # Store çŠ¶æ€ç±»å‹
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- ç±»å‹å®‰å…¨æ€§ â†‘ 90%
- è¿è¡Œæ—¶é”™è¯¯ â†“ 50%
- IDE æ”¯æŒæ›´å®Œå–„

---

### é˜¶æ®µ 3ï¼šç»„ä»¶è§£è€¦ï¼ˆ1å‘¨ï¼‰

#### 3.1 ä¾èµ–æ³¨å…¥æ¨¡å¼

**ç›®æ ‡**ï¼šç§»é™¤ RootStore ç›´æ¥è®¿é—®ï¼Œä½¿ç”¨ä¾èµ–æ³¨å…¥

**å½“å‰é—®é¢˜**ï¼š
```typescript
// âŒ 100+ å¤„ç›´æ¥è®¿é—®
const MyComponent = () => {
  const lumina = RootStore.Get(LuminaStore);
  const user = RootStore.Get(UserStore);
}
```

**ç›®æ ‡æ–¹æ¡ˆ**ï¼š
```typescript
// âœ… ä¾èµ–æ³¨å…¥
const MyComponent = observer(({ lumina, user }: Props) => {
  // é€šè¿‡ props æ¥æ”¶
});

// ä½¿ç”¨è‡ªå®šä¹‰ Hook
const { lumina, user } = useStores();
```

**å…·ä½“ä»»åŠ¡**ï¼š
- [ ] åˆ›å»º `hooks/useStores.ts`
- [ ] åˆ›å»º `hooks/useNoteStore.ts`
- [ ] åˆ›å»º `hooks/useUserStore.ts`
- [ ] é€æ­¥æ›¿æ¢ RootStore.Get() è°ƒç”¨

**é¢„æœŸæ”¶ç›Š**ï¼š
- ç»„ä»¶å¯æµ‹è¯•æ€§ â†‘ 70%
- ç»„ä»¶ç‹¬ç«‹æ€§ â†‘ 60%

---

### é˜¶æ®µ 4ï¼šæ€§èƒ½å’Œç¨³å®šæ€§ï¼ˆ1å‘¨ï¼‰

#### 4.1 æ€§èƒ½ä¼˜åŒ–

**å…·ä½“ä»»åŠ¡**ï¼š
- [ ] ä¿®å¤ N+1 æŸ¥è¯¢é—®é¢˜
- [ ] æ·»åŠ æ•°æ®åº“ç´¢å¼•
- [ ] å®ç°åˆ—è¡¨è™šæ‹ŸåŒ–
- [ ] localStorage æ“ä½œé˜²æŠ–

**é¢„æœŸæ”¶ç›Š**ï¼š
- API å“åº”æ—¶é—´ â†“ 60-80%
- å‰ç«¯æ¸²æŸ“æ€§èƒ½ â†‘ 40-60%
- å†…å­˜ä½¿ç”¨ â†“ 30-40%

#### 4.2 é”™è¯¯å¤„ç†å®Œå–„

**å…·ä½“ä»»åŠ¡**ï¼š
- [ ] åˆ›å»ºç»Ÿä¸€çš„é”™è¯¯å¤„ç†ç±»
- [ ] å®ç°ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- [ ] æ·»åŠ é”™è¯¯ä¸ŠæŠ¥æœºåˆ¶

#### 4.3 å†…å­˜æ³„æ¼ä¿®å¤

**å…·ä½“ä»»åŠ¡**ï¼š
- [ ] æ¸…ç†æœªé‡Šæ”¾çš„è®¢é˜…
- [ ] æ·»åŠ  Store dispose æ–¹æ³•
- [ ] ä¿®å¤ç»„ä»¶å†…å­˜æ³„æ¼

---

## ä»£ç è§„èŒƒ

### TypeScript è§„èŒƒ

```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "forceConsistentCasingInFileNames": true
  }
}
```

### å‘½åè§„èŒƒ

- **ç»„ä»¶**ï¼šPascalCase (ä¾‹ï¼š`NoteCard.tsx`)
- **å‡½æ•°/æ–¹æ³•**ï¼šcamelCase (ä¾‹ï¼š`updateNote()`)
- **å¸¸é‡**ï¼šUPPER_SNAKE_CASE (ä¾‹ï¼š`MAX_RETRY_COUNT`)
- **ç±»å‹/æ¥å£**ï¼šPascalCase (ä¾‹ï¼š`Note`, `NoteFilter`)

### æ–‡ä»¶ç»„ç»‡è§„èŒƒ

```
feature/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ FeatureComponent.tsx
â”‚   â””â”€â”€ FeatureComponent.test.tsx
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useFeature.ts
â”œâ”€â”€ services/
â”‚   â””â”€â”€ featureService.ts
â”œâ”€â”€ types/
â”‚   â””â”€â”€ feature.types.ts
â””â”€â”€ index.ts
```

---

## é¢„æœŸæ€»ä½“æ”¹è¿›æ•ˆæœ

```
ä»£ç å¯ç»´æŠ¤æ€§     â†‘ 80%
ç±»å‹å®‰å…¨æ€§       â†‘ 90%
ç»„ä»¶å¯æµ‹è¯•æ€§     â†‘ 70%
ä»£ç å¯å¤ç”¨æ€§     â†‘ 60%
API æ€§èƒ½        â†‘ 60-80%
å‰ç«¯æ€§èƒ½        â†‘ 40-60%
å†…å­˜ä½¿ç”¨        â†“ 30-40%
Bug ç‡          â†“ 50%
```

---

## è¿›åº¦è¿½è¸ª

- [x] é¡¹ç›®æ¸…ç†å®Œæˆï¼ˆåˆ é™¤ä»£åŠåŠŸèƒ½æ®‹ç•™ï¼‰
- [x] ä»£ç è´¨é‡åˆ†æå®Œæˆ
- [ ] é˜¶æ®µ 1ï¼šæ¶æ„é‡æ„
- [ ] é˜¶æ®µ 2ï¼šç±»å‹å®‰å…¨
- [ ] é˜¶æ®µ 3ï¼šç»„ä»¶è§£è€¦
- [ ] é˜¶æ®µ 4ï¼šæ€§èƒ½ä¼˜åŒ–

---

## å‚è€ƒèµ„æ–™

- [MobX æœ€ä½³å®è·µ](https://mobx.js.org/best-practices.html)
- [React æ€§èƒ½ä¼˜åŒ–](https://react.dev/learn/render-and-commit)
- [Prisma æ€§èƒ½ä¼˜åŒ–](https://www.prisma.io/docs/guides/performance-and-optimization)
- [TypeScript ä¸¥æ ¼æ¨¡å¼](https://www.typescriptlang.org/tsconfig#strict)
